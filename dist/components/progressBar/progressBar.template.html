<div id="whatwhat">
  <div id="icon-progress-line" style="padding-left: {{ ((100 / $ctrl.progressStates.length) / 2) - 1 }}%; padding-right: {{ ((100 / $ctrl.progressStates.length) / 2) - 1 }}%;">
    <uib-progressbar value="(($ctrl.currentIndex()) / ($ctrl.progressStates.length-1) ) * 100"
    type="info"></uib-progressbar>
  </div>

  <ul id="icon-progress-bar" class="nav-justified">
    <li ng-repeat="state in $ctrl.progressStates" class="text-center">
      <a class="btn btn-default" ui-sref="{{state.sref}}"
      ng-class="{
        'btn-info': ($ctrl.currentIndex() >= $ctrl.progressStates.indexOf(state)),
        'btn-lg': $ctrl.isSrefActive(state.sref)
      }">
        <!-- If active state, show the special glyph, and apply bigger circle styles. -->
        <span ng-if="$ctrl.isSrefActive(state.sref)" ng-class="state.glyph"></span>
        <!-- If NOT active state... -->
        <span ng-if="!$ctrl.isSrefActive(state.sref)">
          <!-- If it is listed as visited, then show a checkmark glyph. -->
          <span ng-if="$ctrl.isVisitedState(state)" class="fa fa-check"></span>
          <!-- If NOT listed as visited, then show the step number instead. -->
          <span ng-if="!$ctrl.isVisitedState(state)">{{$ctrl.progressStates.indexOf(state) + 1}}</span>
        </span>
      </a>
    </li>
  </ul>

  <div class="text-center"
    ng-style="{
      'padding-left': ((100 / $ctrl.progressStates.length) * $ctrl.progressStates.indexOf($ctrl.currentState()))+'%',
      'padding-right': ((100 / $ctrl.progressStates.length) * ($ctrl.progressStates.length - $ctrl.progressStates.indexOf($ctrl.currentState()) - 1))+'%'
    }">
    {{ $ctrl.currentState().title | translate}}
  </div>
</div>

<style>
  .progress-bar { height: 5px; }
  .progress { height: 5px; }

  #icon-progress-bar { position: relative; z-index: 10; padding: 0; }
  #icon-progress-bar li .btn { width: 42px; height: 42px; margin-top: 7px; border-radius: 50% 50%; border: none; }
  #icon-progress-bar li .btn-default { background-color: #f3f3f3; }
  #icon-progress-bar li .btn-info { background-color: #5DB0ED; }
  #icon-progress-bar li .btn-lg { width: 56px; height: 56px; margin-top: 4px; }
  #icon-progress-bar li .btn-lg span { font-size: 21px; }

  #icon-progress-line { position: absolute; z-index: 1; padding-top: 31px; margin-right: -15px; margin-left: -15px; }
  #icon-progress-line * { webkit-box-shadow: none; box-shadow: none; }

  @media (max-width: 768px) {
    #icon-progress-line { width: 100%; }
  }
  @media (min-width: 768px) {
    #icon-progress-line { width: 750px; }
  }
  @media (min-width: 992px) {
    #icon-progress-line { width: 970px; }
  }
  @media (min-width: 1200px) {
    #icon-progress-line { width: 1170px; }
  }

/* This media query overrides navbar-justified stacking for MVP, refactor into global CSS later. */
/* TODO: refactor this media query, there are redundant CSS overrides to strip out. */
@media (max-width: 768px) {
    .navbar-header {
        float: left;
    }

    .navbar {
        border-radius: 4px;
        min-width: 400px;
    }

    .nav-tabs-justified > li > a {
        border-bottom: 1px solid #ddd;
        border-radius: 4px 4px 0 0;
    }
    .nav-tabs-justified > .active > a,
    .nav-tabs-justified > .active > a:hover,
    .nav-tabs-justified > .active > a:focus {
        border-bottom-color: #fff;
    }

    .nav-justified > li {
        display: table-cell;
        width: 1%;
    }
    .nav-justified > li > a {
        margin-bottom: 0;
    }

    .nav-tabs.nav-justified > li > a {
        border-bottom: 1px solid #ddd;
        border-radius: 4px 4px 0 0;
    }
    .nav-tabs.nav-justified > .active > a,
    .nav-tabs.nav-justified > .active > a:hover,
    .nav-tabs.nav-justified > .active > a:focus {
        border-bottom-color: #fff;
    }

    .nav-tabs.nav-justified > li {
        display: table-cell;
        width: 1%;
    }
    .nav-tabs.nav-justified > li > a {
        margin-bottom: 0;
    }

    .navbar-right .dropdown-menu {
        right: 0;
        left: auto;
    }
    .navbar-right .dropdown-menu-left {
        right: auto;
        left: 0;
    }
    .container {
        min-width: 400px;
    }

    .navbar-collapse {
        width: auto;
        border-top: 0;
        box-shadow: none;
    }
    .navbar-collapse.collapse {
        display: block !important;
        height: auto !important;
        padding-bottom: 0;
        overflow: visible !important;
    }
    .navbar-collapse.in {
        overflow-y: visible;
    }
    .navbar-fixed-top .navbar-collapse,
    .navbar-static-top .navbar-collapse,
    .navbar-fixed-bottom .navbar-collapse {
        padding-right: 0;
        padding-left: 0;
    }

    .container > .navbar-header,
    .container-fluid > .navbar-header,
    .container > .navbar-collapse,
    .container-fluid > .navbar-collapse {
        margin-right: 0;
        margin-left: 0;
    }

    .navbar-static-top {
        border-radius: 0;
    }

    .navbar-fixed-top,
    .navbar-fixed-bottom {
        border-radius: 0;
    }

    .navbar-toggle {
        display: none;
    }

    .navbar-nav {
        float: left;
        margin: 0;
    }
    .navbar-nav > li {
        float: left;
    }
    .navbar-nav > li > a {
        padding-top: 15px;
        padding-bottom: 15px;
    }
    .navbar-nav.navbar-right:last-child {
        margin-right: -15px;
    }

    .navbar-left {
        float: left !important;
    }
    .navbar-right {
        float: right !important;
    }

    .navbar-form .form-group {
        display: inline-block;
        margin-bottom: 0;
        vertical-align: middle;
    }
    .navbar-form .form-control {
        display: inline-block;
        width: auto;
        vertical-align: middle;
    }
    .navbar-form .control-label {
        margin-bottom: 0;
        vertical-align: middle;
    }
    .navbar-form .radio,
    .navbar-form .checkbox {
        display: inline-block;
        padding-left: 0;
        margin-top: 0;
        margin-bottom: 0;
        vertical-align: middle;
    }
    .navbar-form .radio input[type="radio"],
    .navbar-form .checkbox input[type="checkbox"] {
        float: none;
        margin-left: 0;
    }
    .navbar-form .has-feedback .form-control-feedback {
        top: 0;
    }

    .navbar-form {
        width: auto;
        padding-top: 0;
        padding-bottom: 0;
        margin-right: 0;
        margin-left: 0;
        border: 0;
        -webkit-box-shadow: none;
                box-shadow: none;
    }
    .navbar-form.navbar-right:last-child {
        margin-right: -15px;
    }

    .navbar-text {
        float: left;
        margin-right: 15px;
        margin-left: 15px;
    }
    .navbar-text.navbar-right:last-child {
        margin-right: 0;
    }
}
</style>
